<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Search by Country</title>
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<form class="search-form">
		<input type="text" class="search" placeholder="Country or Capital City">
		<ul class="suggestions"></ul>
	</form>

	<script>
		const endpoint = "https://gist.githubusercontent.com/erdem/8c7d26765831d0f9a8c62f02782ae00d/raw/248037cd701af0a4957cce340dabb0fd04e38f4c/countries.json";
		const countryInfo = [];

		fetch(endpoint)
			.then(res => res.json())
			.then(data => countryInfo.push(...data));

		function findMatches(wordToMatch, list) {
			const regex = new RegExp(wordToMatch, 'gi');
			return list.filter(item => {
				if (item.name) {
					return item.name.match(regex);
				}
				else if (item.capital) {
					return item.capital.match(regex);
				}
				else {
					return null;
				}
			});
		}

		function addHighlight(highlightTerm, word) {
			if (highlightTerm === '') { return word; }

			const regex = new RegExp(highlightTerm, 'gi');
			const matches = word.match(regex) || [];
			const splitWord = word.split(regex);
			let formattedWord = '';

			matches.forEach(match => {
				formattedWord += splitWord.shift();
				formattedWord += `<span class="highlight">${match}</span>`
			})
			if (splitWord.length > 0) { formattedWord += splitWord.shift() };

			return formattedWord;
		}

		function displayMatches() {
			const searchterm = this.value;
			const matches = findMatches(searchterm, countryInfo);

			const suggestedMatches = matches.map(info => {
				const capitalFormatted = info.capital ? `${addHighlight(searchterm, info.capital)}, ` : '';
				const countryFormatted = addHighlight(searchterm, info.name);
				return `<li>${capitalFormatted}${countryFormatted}</li>`;
			}).join('');

			document.querySelector('.suggestions').innerHTML = suggestedMatches;
		}

		const searchInput = document.querySelector('.search');
		searchInput.addEventListener('keyup', displayMatches)
		searchInput.addEventListener('change', displayMatches)

	</script>
</body>
</html>

<!-- ENHANCEMENTS:
	0. FIX SEARCH FUNCTION (e.g. "Bog" does not yield Bogota, and "Dha" does not yield Abu Dhabi)
	1. ACCESSIBLE UI FOR SCREEN READERS, CONTRAST, ETC.
	2. USE A MAP API TO DROP A MAP WITH PIN IN CAPITAL WHEN COUNTRY IS SELECTED
-->
